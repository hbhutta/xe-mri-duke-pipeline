/home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/ml_collections/config_flags/config_flags.py:19: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
  import imp
2025-06-18 17:39:14.779396: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2025-06-18 17:39:15.201968: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/cv2/../../lib64:
2025-06-18 17:39:15.202015: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
2025-06-18 17:39:15.265051: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2025-06-18 17:39:16.227879: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/cv2/../../lib64:
2025-06-18 17:39:16.228011: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/cv2/../../lib64:
2025-06-18 17:39:16.228026: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
WARNING:tensorflow:From /home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/tensorflow/python/compat/v2_compat.py:107: disable_resource_variables (from tensorflow.python.ops.variable_scope) is deprecated and will be removed in a future version.
Instructions for updating:
non-resource variables are not supported in the long term
/home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/keras/optimizers/optimizer_v2/adam.py:114: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  super().__init__(name, **kwargs)
/data/Haad/xe-mri-rachel/xenon-gas-exchange-consortium-main_james_version/utils/metrics.py:4: DeprecationWarning: Please use `binary_dilation` from the `scipy.ndimage` namespace, the `scipy.ndimage.morphology` namespace is deprecated.
  from scipy.ndimage.morphology import binary_dilation
2025-06-18 17:39:17.266078: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/cv2/../../lib64:
2025-06-18 17:39:17.266389: W tensorflow/stream_executor/cuda/cuda_driver.cc:263] failed call to cuInit: UNKNOWN ERROR (303)
2025-06-18 17:39:17.266418: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (epyc02): /proc/driver/nvidia/version does not exist
I0618 17:39:17.266608 140159125288768 subject_classmap.py:74] Initializing gas exchange imaging subject.
split_mask received file path: cohort/PIm0025/CT_lobe_mask_neg_affine.nii
Making Nifti1Image objects out of splits data
File already exists: cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii
File already exists: cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii
File already exists: cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_32.nii
File already exists: cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_64.nii
File already exists: cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_128.nii
split_mask received file path: cohort/PIm0025/ct_corepeel_mask_neg_affine_mod_x_y_z.nii
Making Nifti1Image objects out of splits data
File already exists: cohort/PIm0025/ct_corepeel_mask_neg_affine_mod_x_y_z_split_PI_40.nii
File already exists: cohort/PIm0025/ct_corepeel_mask_neg_affine_mod_x_y_z_split_PI_50.nii
Processing split cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii
Reading #1 from cohort/PIm0025/mask_vent_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/mask_vent_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_8_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.mask_vent to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii)
Reading #1 from cohort/PIm0025/image_gas_binned_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_gas_binned_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_8_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_gas_binned to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii)
Reading #1 from cohort/PIm0025/image_rbc2gas_binned_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_rbc2gas_binned_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_8_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_rbc2gas_binned to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii)
Reading #1 from cohort/PIm0025/image_rbc2gas_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_rbc2gas_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_8_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_rbc2gas to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii)
Reading #1 from cohort/PIm0025/image_membrane2gas_binned_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_membrane2gas_binned_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_8_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_membrane2gas_binned to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii)
Reading #1 from cohort/PIm0025/image_membrane2gas_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_membrane2gas_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_8_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_membrane2gas to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_8.nii)
computing bin_percentage
bin_percentage(): volume_in_bins = 2658
bin_percentage(): mask_volume = 2214028
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2214028
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2214028
computing mean
mean(): image.shape = (512, 512, 396)
mean(): mask.shape = (512, 512, 396)
Computed mean: 0.6724638394079823
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2029328
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2029328
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2029328
computing mean
mean(): image.shape = (512, 512, 396)
mean(): mask.shape = (512, 512, 396)
Computed mean: 0.029654192442923926
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2029328
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2029328
computing bin_percentage
bin_percentage(): volume_in_bins = 25423
bin_percentage(): mask_volume = 2029328
computing mean
mean(): image.shape = (512, 512, 396)
mean(): mask.shape = (512, 512, 396)
Computed mean: 0.05119128959534817

              stats.py:
              
	Finished computing ventilation, RBC and membrane defect percentages and means for patient PIm0025.
              
	Please view the following images in ITK-SNAP:
              
		image_gas_binned.nii
              
		image_rbc2gas.nii
              
		image_rbc2gas_binned.nii
              
		image_membrane2gas.nii
              
		image_membrane2gas_binned.nii
              
		mask_reg_edited_mutated_affine_resized_warped.nii
              
		mask_vent_mutated_affine_resized_warped.nii
              
	Press enter to continue once you have viewed these images. 
              Processing split cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii
Reading #1 from cohort/PIm0025/mask_vent_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/mask_vent_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_16_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.mask_vent to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii)
Reading #1 from cohort/PIm0025/image_gas_binned_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_gas_binned_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_16_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_gas_binned to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii)
Reading #1 from cohort/PIm0025/image_rbc2gas_binned_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_rbc2gas_binned_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_16_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_rbc2gas_binned to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii)
Reading #1 from cohort/PIm0025/image_rbc2gas_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_rbc2gas_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_16_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_rbc2gas to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii)
Reading #1 from cohort/PIm0025/image_membrane2gas_binned_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_membrane2gas_binned_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_16_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_membrane2gas_binned to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii)
Reading #1 from cohort/PIm0025/image_membrane2gas_mutated_affine_resized_warped.nii
Reading #2 from cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii
Multiplying #2 and #1
Writing #1 to file cohort/PIm0025/image_membrane2gas_mutated_affine_resized_warped__CT_lobe_mask_neg_affine_split_PI_16_product.nii
  Output voxel type: float[f]
  Rounding off: Disabled
stats.py: Set subject.image_membrane2gas to its intersection with the current split (cohort/PIm0025/CT_lobe_mask_neg_affine_split_PI_16.nii)
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2173890
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2173890
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2173890
computing mean
mean(): image.shape = (512, 512, 396)
mean(): mask.shape = (512, 512, 396)
Computed mean: 0.7238364334664776
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2065446
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2065446
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2065446
computing mean
mean(): image.shape = (512, 512, 396)
mean(): mask.shape = (512, 512, 396)
Computed mean: 0.059109688678015276
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2065446
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2065446
computing bin_percentage
bin_percentage(): volume_in_bins = 0
bin_percentage(): mask_volume = 2065446
computing mean
mean(): image.shape = (512, 512, 396)
mean(): mask.shape = (512, 512, 396)
Computed mean: 0.12242022373397353

              stats.py:
              
	Finished computing ventilation, RBC and membrane defect percentages and means for patient PIm0025.
              
	Please view the following images in ITK-SNAP:
              
		image_gas_binned.nii
              
		image_rbc2gas.nii
              
		image_rbc2gas_binned.nii
              
		image_membrane2gas.nii
              
		image_membrane2gas_binned.nii
              
		mask_reg_edited_mutated_affine_resized_warped.nii
              
		mask_vent_mutated_affine_resized_warped.nii
              
	Press enter to continue once you have viewed these images. 
              Traceback (most recent call last):
  File "stats.py", line 318, in <module>
    app.run(main)
  File "/home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/absl/app.py", line 308, in run
    _run_main(main, args)
  File "/home/hbhutta/miniconda3/envs/xe-mri/lib/python3.8/site-packages/absl/app.py", line 254, in _run_main
    sys.exit(main(argv))
  File "stats.py", line 310, in main
    compute_patient_stats(config)
  File "stats.py", line 282, in compute_patient_stats
    input(f"""
KeyboardInterrupt
